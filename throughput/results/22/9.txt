BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%bisque%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 268683610.726202
 ALGERIA                   |   1997 |  463614701.87767
 ALGERIA                   |   1996 | 463147435.656566
 ALGERIA                   |   1995 | 463052884.720723
 ALGERIA                   |   1994 | 461176192.408916
 ALGERIA                   |   1993 | 462810044.632471
 ALGERIA                   |   1992 | 454149891.289393
 ARGENTINA                 |   1998 | 271157013.618009
 ARGENTINA                 |   1997 | 466300629.885422
 ARGENTINA                 |   1996 | 469143252.927373
 ARGENTINA                 |   1995 | 460574420.084272
 ARGENTINA                 |   1994 | 464754373.977686
 ARGENTINA                 |   1993 | 462267266.879559
 ARGENTINA                 |   1992 | 462510340.130945
 BRAZIL                    |   1998 | 275730886.367086
 BRAZIL                    |   1997 | 472976537.080676
 BRAZIL                    |   1996 | 476992034.305833
 BRAZIL                    |   1995 | 468242114.566249
 BRAZIL                    |   1994 | 476407609.098161
 BRAZIL                    |   1993 | 468116748.595428
 BRAZIL                    |   1992 | 476313763.183148
 CANADA                    |   1998 | 281989562.304353
 CANADA                    |   1997 | 480575897.800239
 CANADA                    |   1996 | 482591793.208662
 CANADA                    |   1995 | 477352085.491063
 CANADA                    |   1994 | 486039142.220467
 CANADA                    |   1993 | 472259782.375278
 CANADA                    |   1992 | 481049205.750357
 CHINA                     |   1998 | 272907643.453753
 CHINA                     |   1997 |   474665011.6314
 CHINA                     |   1996 | 470685026.965189
 CHINA                     |   1995 | 472499456.596828
 CHINA                     |   1994 | 468768607.958717
 CHINA                     |   1993 | 480424448.072325
 CHINA                     |   1992 | 474906642.163094
 EGYPT                     |   1998 | 279220439.484114
 EGYPT                     |   1997 | 469951519.197544
 EGYPT                     |   1996 | 473193237.194495
 EGYPT                     |   1995 | 468121784.640302
 EGYPT                     |   1994 | 478513822.364088
 EGYPT                     |   1993 | 470114618.190836
 EGYPT                     |   1992 | 472703544.123031
 ETHIOPIA                  |   1998 | 272677959.846425
 ETHIOPIA                  |   1997 | 463533318.328717
 ETHIOPIA                  |   1996 | 463943819.155655
 ETHIOPIA                  |   1995 | 453929403.392504
 ETHIOPIA                  |   1994 | 458319502.406332
 ETHIOPIA                  |   1993 | 460636655.041959
 ETHIOPIA                  |   1992 |  467747411.73433
 FRANCE                    |   1998 | 274940141.698906
 FRANCE                    |   1997 | 456584665.507994
 FRANCE                    |   1996 | 466414187.986929
 FRANCE                    |   1995 | 458729726.531553
 FRANCE                    |   1994 | 460502236.528807
 FRANCE                    |   1993 | 465447131.960373
 FRANCE                    |   1992 | 457244269.971009
 GERMANY                   |   1998 | 271570831.370692
 GERMANY                   |   1997 | 463860835.570123
 GERMANY                   |   1996 |  456293495.06638
 GERMANY                   |   1995 | 470572758.733959
 GERMANY                   |   1994 | 471989863.960535
 GERMANY                   |   1993 | 465630914.711209
 GERMANY                   |   1992 | 471611921.920354
 INDIA                     |   1998 | 275089242.463163
 INDIA                     |   1997 | 478176403.820587
 INDIA                     |   1996 | 476002728.479268
 INDIA                     |   1995 | 474248338.395411
 INDIA                     |   1994 | 479958739.958282
 INDIA                     |   1993 | 469291600.767148
 INDIA                     |   1992 | 474731456.258194
 INDONESIA                 |   1998 | 270600248.750381
 INDONESIA                 |   1997 | 466035622.649699
 INDONESIA                 |   1996 | 468841994.253946
 INDONESIA                 |   1995 | 464347177.586136
 INDONESIA                 |   1994 |   463391947.4579
 INDONESIA                 |   1993 | 466119932.463066
 INDONESIA                 |   1992 | 466508351.491418
 IRAN                      |   1998 | 271400784.644399
 IRAN                      |   1997 | 470070510.823398
 IRAN                      |   1996 | 466358958.357092
 IRAN                      |   1995 |  474339618.48622
 IRAN                      |   1994 | 466490918.868498
 IRAN                      |   1993 | 470622627.150758
 IRAN                      |   1992 | 472363007.562254
 IRAQ                      |   1998 |  277434256.23539
 IRAQ                      |   1997 | 476337063.824786
 IRAQ                      |   1996 | 472982418.529172
 IRAQ                      |   1995 | 473356821.486532
 IRAQ                      |   1994 | 479137133.474155
 IRAQ                      |   1993 | 474231361.392115
 IRAQ                      |   1992 | 482443945.301897
 JAPAN                     |   1998 | 270134436.673686
 JAPAN                     |   1997 | 463079957.660446
 JAPAN                     |   1996 | 472821195.623054
 JAPAN                     |   1995 |  460195605.25002
 JAPAN                     |   1994 | 461777586.561417
 JAPAN                     |   1993 |  467250397.68393
 JAPAN                     |   1992 | 462101884.368366
 JORDAN                    |   1998 | 278607844.875957
 JORDAN                    |   1997 |  464408994.02361
 JORDAN                    |   1996 | 466430129.082911
 JORDAN                    |   1995 | 457031948.702116
 JORDAN                    |   1994 | 463805737.712245
 JORDAN                    |   1993 | 464536107.057827
 JORDAN                    |   1992 | 459473946.077595
 KENYA                     |   1998 | 278298383.086431
 KENYA                     |   1997 | 473448225.922895
 KENYA                     |   1996 | 481769624.038638
 KENYA                     |   1995 | 484389760.199064
 KENYA                     |   1994 | 479394751.107935
 KENYA                     |   1993 | 474892307.834492
 KENYA                     |   1992 | 479204906.670894
 MOROCCO                   |   1998 | 276895906.609111
 MOROCCO                   |   1997 | 465464701.283876
 MOROCCO                   |   1996 | 467157081.500664
 MOROCCO                   |   1995 | 470539848.759828
 MOROCCO                   |   1994 |   466763653.5607
 MOROCCO                   |   1993 | 472834977.709227
 MOROCCO                   |   1992 | 474820580.111682
 MOZAMBIQUE                |   1998 | 269539344.344068
 MOZAMBIQUE                |   1997 | 457212813.958809
 MOZAMBIQUE                |   1996 | 456959432.370012
 MOZAMBIQUE                |   1995 | 459932451.210856
 MOZAMBIQUE                |   1994 | 461253182.665959
 MOZAMBIQUE                |   1993 |  448756106.46531
 MOZAMBIQUE                |   1992 | 452176726.520917
 PERU                      |   1998 | 273484254.720892
 PERU                      |   1997 | 474230088.199088
 PERU                      |   1996 | 478444870.094823
 PERU                      |   1995 |  476924113.50691
 PERU                      |   1994 | 467175887.754571
 PERU                      |   1993 | 469510207.337801
 PERU                      |   1992 | 470159620.137173
 ROMANIA                   |   1998 | 282801184.657634
 ROMANIA                   |   1997 | 479849851.988471
 ROMANIA                   |   1996 | 475404652.070879
 ROMANIA                   |   1995 | 477569156.844149
 ROMANIA                   |   1994 | 473225529.822064
 ROMANIA                   |   1993 | 480515177.118832
 ROMANIA                   |   1992 | 474010203.084832
 RUSSIA                    |   1998 | 279116639.992801
 RUSSIA                    |   1997 | 481974032.559111
 RUSSIA                    |   1996 | 470359713.650173
 RUSSIA                    |   1995 | 471904495.247961
 RUSSIA                    |   1994 | 468515410.228031
 RUSSIA                    |   1993 |  470103939.04086
 RUSSIA                    |   1992 | 474637257.638474
 SAUDI ARABIA              |   1998 | 278684593.509225
 SAUDI ARABIA              |   1997 | 474116473.842888
 SAUDI ARABIA              |   1996 |  474199180.98713
 SAUDI ARABIA              |   1995 |  476653335.83759
 SAUDI ARABIA              |   1994 | 472163058.683091
 SAUDI ARABIA              |   1993 | 473154134.625198
 SAUDI ARABIA              |   1992 | 482704226.695022
 UNITED KINGDOM            |   1998 | 275685818.033958
 UNITED KINGDOM            |   1997 | 465514792.545087
 UNITED KINGDOM            |   1996 | 466541905.129315
 UNITED KINGDOM            |   1995 | 465398535.919901
 UNITED KINGDOM            |   1994 | 471602569.886736
 UNITED KINGDOM            |   1993 | 468342279.511163
 UNITED KINGDOM            |   1992 | 469212186.296287
 UNITED STATES             |   1998 | 271107805.266778
 UNITED STATES             |   1997 | 477487983.595795
 UNITED STATES             |   1996 | 479799720.520546
 UNITED STATES             |   1995 |  482324746.64264
 UNITED STATES             |   1994 | 474289899.392176
 UNITED STATES             |   1993 | 478948620.407749
 UNITED STATES             |   1992 | 477956345.288886
 VIETNAM                   |   1998 | 266726512.947071
 VIETNAM                   |   1997 | 463526774.999858
 VIETNAM                   |   1996 | 472775399.629637
 VIETNAM                   |   1995 | 461715526.802168
 VIETNAM                   |   1994 | 474111912.680918
 VIETNAM                   |   1993 | 467383080.989161
 VIETNAM                   |   1992 |  473198481.46491
(175 rows)

COMMIT;
COMMIT
