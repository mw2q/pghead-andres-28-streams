BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%dark%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 |  265392463.46768
 ALGERIA                   |   1997 | 442317954.508747
 ALGERIA                   |   1996 | 452581926.629315
 ALGERIA                   |   1995 | 446419215.658592
 ALGERIA                   |   1994 | 452316274.330041
 ALGERIA                   |   1993 | 447342879.620236
 ALGERIA                   |   1992 | 452611873.632837
 ARGENTINA                 |   1998 | 270212611.205217
 ARGENTINA                 |   1997 | 466795431.142768
 ARGENTINA                 |   1996 | 468421879.193569
 ARGENTINA                 |   1995 | 460914797.519863
 ARGENTINA                 |   1994 | 466415824.277032
 ARGENTINA                 |   1993 | 473345463.679578
 ARGENTINA                 |   1992 | 462647380.642251
 BRAZIL                    |   1998 | 268948118.709979
 BRAZIL                    |   1997 | 463957234.421273
 BRAZIL                    |   1996 | 468781633.230994
 BRAZIL                    |   1995 | 467487855.452521
 BRAZIL                    |   1994 | 479511057.231613
 BRAZIL                    |   1993 | 467378398.529565
 BRAZIL                    |   1992 | 466574924.365398
 CANADA                    |   1998 | 279553886.418581
 CANADA                    |   1997 | 464386389.238991
 CANADA                    |   1996 | 472791321.987618
 CANADA                    |   1995 |  471396013.25559
 CANADA                    |   1994 |  485820785.49031
 CANADA                    |   1993 | 476779532.314728
 CANADA                    |   1992 |   471025466.5763
 CHINA                     |   1998 | 278040540.992542
 CHINA                     |   1997 | 474965401.937923
 CHINA                     |   1996 | 472348528.239655
 CHINA                     |   1995 | 473963308.909037
 CHINA                     |   1994 | 479924313.525438
 CHINA                     |   1993 | 472896492.035464
 CHINA                     |   1992 | 474110626.961809
 EGYPT                     |   1998 | 272456706.411984
 EGYPT                     |   1997 | 463679472.818297
 EGYPT                     |   1996 | 468620297.949847
 EGYPT                     |   1995 | 454869779.513079
 EGYPT                     |   1994 | 454546974.154508
 EGYPT                     |   1993 | 456446940.997138
 EGYPT                     |   1992 | 460684021.937109
 ETHIOPIA                  |   1998 | 268364239.525791
 ETHIOPIA                  |   1997 | 462190893.163904
 ETHIOPIA                  |   1996 | 464326900.833367
 ETHIOPIA                  |   1995 | 461163534.654917
 ETHIOPIA                  |   1994 | 462708458.970061
 ETHIOPIA                  |   1993 | 459414600.923281
 ETHIOPIA                  |   1992 | 465267484.601884
 FRANCE                    |   1998 | 270277415.351648
 FRANCE                    |   1997 | 455280134.486196
 FRANCE                    |   1996 | 458393963.963897
 FRANCE                    |   1995 |  451006026.70891
 FRANCE                    |   1994 | 467344128.611116
 FRANCE                    |   1993 | 454498410.234063
 FRANCE                    |   1992 | 464945094.566948
 GERMANY                   |   1998 | 272080262.163491
 GERMANY                   |   1997 | 472689957.100302
 GERMANY                   |   1996 |  475920820.63822
 GERMANY                   |   1995 | 472246075.949961
 GERMANY                   |   1994 | 468996227.499037
 GERMANY                   |   1993 | 476763760.378322
 GERMANY                   |   1992 | 475004108.270607
 INDIA                     |   1998 | 278671070.245978
 INDIA                     |   1997 |  470335254.65868
 INDIA                     |   1996 | 476317141.662604
 INDIA                     |   1995 |  471379166.30451
 INDIA                     |   1994 | 473297406.945293
 INDIA                     |   1993 | 476396131.740261
 INDIA                     |   1992 | 473772123.830138
 INDONESIA                 |   1998 | 269078442.892683
 INDONESIA                 |   1997 | 456032295.988057
 INDONESIA                 |   1996 | 460265879.880226
 INDONESIA                 |   1995 | 461858836.625162
 INDONESIA                 |   1994 | 457266244.673198
 INDONESIA                 |   1993 | 460128897.118295
 INDONESIA                 |   1992 | 453467758.884374
 IRAN                      |   1998 | 270644426.748148
 IRAN                      |   1997 | 462596052.445053
 IRAN                      |   1996 | 460190815.612982
 IRAN                      |   1995 | 460283340.467912
 IRAN                      |   1994 | 450528670.703504
 IRAN                      |   1993 | 454848755.777347
 IRAN                      |   1992 | 457528517.902155
 IRAQ                      |   1998 | 277790331.427486
 IRAQ                      |   1997 | 472543514.467748
 IRAQ                      |   1996 | 481371230.862512
 IRAQ                      |   1995 | 478034525.589292
 IRAQ                      |   1994 | 477314173.661419
 IRAQ                      |   1993 | 479647940.855541
 IRAQ                      |   1992 | 465324260.474874
 JAPAN                     |   1998 | 273806646.359012
 JAPAN                     |   1997 | 464744050.411904
 JAPAN                     |   1996 | 461645659.297238
 JAPAN                     |   1995 | 469298276.310773
 JAPAN                     |   1994 | 466952735.429809
 JAPAN                     |   1993 | 463137363.220756
 JAPAN                     |   1992 | 457262742.388509
 JORDAN                    |   1998 | 267313567.895561
 JORDAN                    |   1997 | 452767150.401844
 JORDAN                    |   1996 | 461848907.846986
 JORDAN                    |   1995 | 455341303.277654
 JORDAN                    |   1994 | 455030020.255092
 JORDAN                    |   1993 | 461831906.301578
 JORDAN                    |   1992 | 463027825.579953
 KENYA                     |   1998 | 279089762.875665
 KENYA                     |   1997 | 471110129.880759
 KENYA                     |   1996 | 473608398.116571
 KENYA                     |   1995 | 470694673.363917
 KENYA                     |   1994 | 475576650.670073
 KENYA                     |   1993 |  484619996.04523
 KENYA                     |   1992 | 474626019.245522
 MOROCCO                   |   1998 |   269523564.2159
 MOROCCO                   |   1997 | 470084511.663344
 MOROCCO                   |   1996 | 474194935.703068
 MOROCCO                   |   1995 | 466573404.094994
 MOROCCO                   |   1994 | 466989864.326117
 MOROCCO                   |   1993 | 464258747.847014
 MOROCCO                   |   1992 | 476104358.771814
 MOZAMBIQUE                |   1998 |  273655534.07063
 MOZAMBIQUE                |   1997 |  456896093.97118
 MOZAMBIQUE                |   1996 | 462520123.476215
 MOZAMBIQUE                |   1995 | 461359519.007041
 MOZAMBIQUE                |   1994 | 460889377.130931
 MOZAMBIQUE                |   1993 | 451320625.185773
 MOZAMBIQUE                |   1992 | 455506360.276519
 PERU                      |   1998 | 270892830.476911
 PERU                      |   1997 | 473051818.179249
 PERU                      |   1996 | 462410265.301052
 PERU                      |   1995 | 467149860.594522
 PERU                      |   1994 | 458919323.380293
 PERU                      |   1993 | 466830703.955954
 PERU                      |   1992 | 468930637.369553
 ROMANIA                   |   1998 | 271701261.696104
 ROMANIA                   |   1997 |  466170792.52776
 ROMANIA                   |   1996 | 463892391.064003
 ROMANIA                   |   1995 | 460559588.972092
 ROMANIA                   |   1994 | 468498920.599729
 ROMANIA                   |   1993 | 459795704.967732
 ROMANIA                   |   1992 | 464227757.306098
 RUSSIA                    |   1998 | 275036509.153813
 RUSSIA                    |   1997 | 458106668.302109
 RUSSIA                    |   1996 | 467775180.540883
 RUSSIA                    |   1995 | 459013659.617306
 RUSSIA                    |   1994 | 460373225.588832
 RUSSIA                    |   1993 | 458664488.777413
 RUSSIA                    |   1992 | 468809427.755672
 SAUDI ARABIA              |   1998 | 281109614.617131
 SAUDI ARABIA              |   1997 | 470342115.315411
 SAUDI ARABIA              |   1996 | 477286373.409836
 SAUDI ARABIA              |   1995 | 481802889.730456
 SAUDI ARABIA              |   1994 | 471913132.364659
 SAUDI ARABIA              |   1993 | 478898360.150147
 SAUDI ARABIA              |   1992 | 481344872.043246
 UNITED KINGDOM            |   1998 | 266237637.847368
 UNITED KINGDOM            |   1997 | 461348346.453607
 UNITED KINGDOM            |   1996 | 460575284.857404
 UNITED KINGDOM            |   1995 | 449756393.883224
 UNITED KINGDOM            |   1994 | 453572438.568421
 UNITED KINGDOM            |   1993 | 457918861.538668
 UNITED KINGDOM            |   1992 | 462513442.329199
 UNITED STATES             |   1998 | 271019121.133772
 UNITED STATES             |   1997 | 472420823.298923
 UNITED STATES             |   1996 | 468045226.609664
 UNITED STATES             |   1995 | 467419566.046907
 UNITED STATES             |   1994 | 477943117.891677
 UNITED STATES             |   1993 | 469125635.480782
 UNITED STATES             |   1992 | 471151045.254038
 VIETNAM                   |   1998 | 270002734.613411
 VIETNAM                   |   1997 | 463222552.178994
 VIETNAM                   |   1996 |  468087150.29188
 VIETNAM                   |   1995 | 461400975.930463
 VIETNAM                   |   1994 | 460847512.827821
 VIETNAM                   |   1993 |  457737494.16009
 VIETNAM                   |   1992 | 455704916.557845
(175 rows)

COMMIT;
COMMIT
