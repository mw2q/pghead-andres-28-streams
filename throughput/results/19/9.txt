BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%dim%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 271053597.726432
 ALGERIA                   |   1997 | 461674377.704531
 ALGERIA                   |   1996 |  467349862.10359
 ALGERIA                   |   1995 | 455789322.168341
 ALGERIA                   |   1994 | 454753148.707862
 ALGERIA                   |   1993 | 460503176.645444
 ALGERIA                   |   1992 | 456375863.643002
 ARGENTINA                 |   1998 | 274932421.434534
 ARGENTINA                 |   1997 | 477511905.208166
 ARGENTINA                 |   1996 | 470148322.259781
 ARGENTINA                 |   1995 | 474984552.902947
 ARGENTINA                 |   1994 | 470939145.578021
 ARGENTINA                 |   1993 | 467387005.403678
 ARGENTINA                 |   1992 | 470190685.260347
 BRAZIL                    |   1998 | 270590108.104321
 BRAZIL                    |   1997 | 461964318.687935
 BRAZIL                    |   1996 | 464059083.448416
 BRAZIL                    |   1995 | 461913957.133616
 BRAZIL                    |   1994 | 459490955.469409
 BRAZIL                    |   1993 | 465851790.065228
 BRAZIL                    |   1992 |   464085574.7044
 CANADA                    |   1998 | 276493025.970336
 CANADA                    |   1997 |  467631816.36522
 CANADA                    |   1996 | 476439433.142177
 CANADA                    |   1995 | 472448929.508237
 CANADA                    |   1994 | 475569505.681098
 CANADA                    |   1993 | 469444214.151977
 CANADA                    |   1992 |  476572158.59009
 CHINA                     |   1998 | 275824706.457255
 CHINA                     |   1997 | 469672474.163927
 CHINA                     |   1996 | 467660827.329017
 CHINA                     |   1995 | 470958391.115251
 CHINA                     |   1994 | 463943025.484437
 CHINA                     |   1993 |  467430187.49451
 CHINA                     |   1992 | 471640713.539751
 EGYPT                     |   1998 | 277515880.432512
 EGYPT                     |   1997 | 472865875.447423
 EGYPT                     |   1996 | 474088270.754541
 EGYPT                     |   1995 | 462812433.129901
 EGYPT                     |   1994 | 467113141.534456
 EGYPT                     |   1993 | 467795741.151684
 EGYPT                     |   1992 | 468393353.183579
 ETHIOPIA                  |   1998 | 266256733.896242
 ETHIOPIA                  |   1997 | 454423959.342489
 ETHIOPIA                  |   1996 |  455385534.89642
 ETHIOPIA                  |   1995 | 455539720.492754
 ETHIOPIA                  |   1994 | 453444096.050015
 ETHIOPIA                  |   1993 | 459007430.320077
 ETHIOPIA                  |   1992 | 462755396.514287
 FRANCE                    |   1998 | 264994629.673643
 FRANCE                    |   1997 | 459361090.927475
 FRANCE                    |   1996 | 453776866.204703
 FRANCE                    |   1995 | 455275784.358283
 FRANCE                    |   1994 | 457084202.937875
 FRANCE                    |   1993 | 457469541.556615
 FRANCE                    |   1992 | 451102279.969413
 GERMANY                   |   1998 | 280591565.311206
 GERMANY                   |   1997 | 474645225.410678
 GERMANY                   |   1996 |  474784296.93426
 GERMANY                   |   1995 | 475740849.011777
 GERMANY                   |   1994 | 478083236.571537
 GERMANY                   |   1993 | 480250852.178735
 GERMANY                   |   1992 | 476964040.721575
 INDIA                     |   1998 | 271885294.468139
 INDIA                     |   1997 | 481741866.641157
 INDIA                     |   1996 | 479325219.115948
 INDIA                     |   1995 | 477981433.057563
 INDIA                     |   1994 | 472423518.847125
 INDIA                     |   1993 | 471777648.320616
 INDIA                     |   1992 | 477888572.189121
 INDONESIA                 |   1998 | 271629501.797098
 INDONESIA                 |   1997 |  464107509.52681
 INDONESIA                 |   1996 | 472669755.517923
 INDONESIA                 |   1995 | 468854818.342791
 INDONESIA                 |   1994 |   460385490.8591
 INDONESIA                 |   1993 | 473115142.742235
 INDONESIA                 |   1992 |  469257394.82922
 IRAN                      |   1998 | 273627641.835346
 IRAN                      |   1997 | 465380712.305568
 IRAN                      |   1996 | 453695213.214738
 IRAN                      |   1995 | 457372605.067931
 IRAN                      |   1994 | 458036237.420397
 IRAN                      |   1993 | 454403896.645941
 IRAN                      |   1992 | 457651640.989154
 IRAQ                      |   1998 | 274039783.487066
 IRAQ                      |   1997 | 474112338.642666
 IRAQ                      |   1996 | 472309103.819545
 IRAQ                      |   1995 | 474084362.397923
 IRAQ                      |   1994 | 471980096.393001
 IRAQ                      |   1993 | 472223323.182499
 IRAQ                      |   1992 | 476340001.047968
 JAPAN                     |   1998 | 269415045.506952
 JAPAN                     |   1997 | 465997846.788194
 JAPAN                     |   1996 | 465634190.390824
 JAPAN                     |   1995 | 468888410.633912
 JAPAN                     |   1994 | 456327960.633688
 JAPAN                     |   1993 | 463829773.659255
 JAPAN                     |   1992 | 459981341.300003
 JORDAN                    |   1998 | 275388518.691002
 JORDAN                    |   1997 | 459958400.568637
 JORDAN                    |   1996 | 458123255.255095
 JORDAN                    |   1995 |  456677773.35723
 JORDAN                    |   1994 | 456116508.291782
 JORDAN                    |   1993 | 456039455.537154
 JORDAN                    |   1992 | 462315239.401399
 KENYA                     |   1998 | 273837080.150804
 KENYA                     |   1997 | 467123441.549876
 KENYA                     |   1996 | 473279095.962111
 KENYA                     |   1995 | 465716743.807418
 KENYA                     |   1994 | 467125512.932507
 KENYA                     |   1993 | 473623206.199529
 KENYA                     |   1992 | 473151345.917727
 MOROCCO                   |   1998 | 275810770.935707
 MOROCCO                   |   1997 | 470310136.074476
 MOROCCO                   |   1996 |  464273439.22392
 MOROCCO                   |   1995 | 468818398.000388
 MOROCCO                   |   1994 | 470761304.600311
 MOROCCO                   |   1993 | 463525198.077241
 MOROCCO                   |   1992 | 468983264.122433
 MOZAMBIQUE                |   1998 | 275404087.481121
 MOZAMBIQUE                |   1997 | 469606613.835273
 MOZAMBIQUE                |   1996 | 466971814.586015
 MOZAMBIQUE                |   1995 |  471233738.54832
 MOZAMBIQUE                |   1994 | 459488271.685951
 MOZAMBIQUE                |   1993 | 463745064.497392
 MOZAMBIQUE                |   1992 | 460727054.358797
 PERU                      |   1998 | 275909812.609282
 PERU                      |   1997 | 468586135.675544
 PERU                      |   1996 | 461255714.529994
 PERU                      |   1995 | 459196758.806863
 PERU                      |   1994 | 462793129.199294
 PERU                      |   1993 | 464749102.408885
 PERU                      |   1992 | 468778298.439419
 ROMANIA                   |   1998 | 276561978.437798
 ROMANIA                   |   1997 | 467087772.214138
 ROMANIA                   |   1996 | 473168235.633539
 ROMANIA                   |   1995 | 466571919.173886
 ROMANIA                   |   1994 | 471879495.768879
 ROMANIA                   |   1993 | 471482636.022426
 ROMANIA                   |   1992 | 471913613.211833
 RUSSIA                    |   1998 | 277987141.752139
 RUSSIA                    |   1997 | 473167561.909003
 RUSSIA                    |   1996 | 474823380.591853
 RUSSIA                    |   1995 | 477989634.514197
 RUSSIA                    |   1994 | 473117204.780997
 RUSSIA                    |   1993 | 472482962.923578
 RUSSIA                    |   1992 | 481594538.927723
 SAUDI ARABIA              |   1998 | 270859286.839831
 SAUDI ARABIA              |   1997 | 458357703.402716
 SAUDI ARABIA              |   1996 | 461724307.917093
 SAUDI ARABIA              |   1995 | 462507492.921291
 SAUDI ARABIA              |   1994 | 462507508.663871
 SAUDI ARABIA              |   1993 | 466959483.855776
 SAUDI ARABIA              |   1992 | 474895290.795634
 UNITED KINGDOM            |   1998 | 273445518.589142
 UNITED KINGDOM            |   1997 | 463611752.787858
 UNITED KINGDOM            |   1996 | 463275395.852737
 UNITED KINGDOM            |   1995 | 463052160.736935
 UNITED KINGDOM            |   1994 | 466711901.339696
 UNITED KINGDOM            |   1993 | 461285688.177633
 UNITED KINGDOM            |   1992 | 463550593.070551
 UNITED STATES             |   1998 |  283876845.85771
 UNITED STATES             |   1997 | 474676382.485237
 UNITED STATES             |   1996 | 477335412.253809
 UNITED STATES             |   1995 | 475161974.501729
 UNITED STATES             |   1994 | 476151985.740335
 UNITED STATES             |   1993 | 481258218.182963
 UNITED STATES             |   1992 | 485624141.807016
 VIETNAM                   |   1998 |  274923254.43662
 VIETNAM                   |   1997 | 465041847.843157
 VIETNAM                   |   1996 | 470136537.214255
 VIETNAM                   |   1995 | 466597475.485052
 VIETNAM                   |   1994 | 466052026.906103
 VIETNAM                   |   1993 | 475386926.425753
 VIETNAM                   |   1992 | 465688715.793323
(175 rows)

COMMIT;
COMMIT
