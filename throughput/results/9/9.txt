BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%steel%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 269032777.968015
 ALGERIA                   |   1997 | 461249619.139898
 ALGERIA                   |   1996 | 465428657.858147
 ALGERIA                   |   1995 | 468370161.201549
 ALGERIA                   |   1994 | 461085859.140984
 ALGERIA                   |   1993 | 467450988.225402
 ALGERIA                   |   1992 |  467483230.05005
 ARGENTINA                 |   1998 | 275452475.953945
 ARGENTINA                 |   1997 | 471071545.813401
 ARGENTINA                 |   1996 | 471953500.078017
 ARGENTINA                 |   1995 |  467923208.28391
 ARGENTINA                 |   1994 | 471172241.282713
 ARGENTINA                 |   1993 | 470537179.726172
 ARGENTINA                 |   1992 | 466132371.840094
 BRAZIL                    |   1998 |  272605833.08781
 BRAZIL                    |   1997 | 460699964.952745
 BRAZIL                    |   1996 | 460720169.713374
 BRAZIL                    |   1995 | 462745539.023356
 BRAZIL                    |   1994 | 465394054.718508
 BRAZIL                    |   1993 | 468308821.206956
 BRAZIL                    |   1992 | 463765105.618736
 CANADA                    |   1998 | 276694574.822131
 CANADA                    |   1997 | 483504479.853888
 CANADA                    |   1996 | 481228678.120138
 CANADA                    |   1995 | 476544862.679555
 CANADA                    |   1994 | 484979462.464258
 CANADA                    |   1993 | 475677044.210984
 CANADA                    |   1992 |  476302336.26947
 CHINA                     |   1998 | 274227069.275669
 CHINA                     |   1997 | 469632558.113643
 CHINA                     |   1996 | 468550552.264474
 CHINA                     |   1995 | 461053331.651812
 CHINA                     |   1994 | 466298121.114114
 CHINA                     |   1993 | 469309099.512325
 CHINA                     |   1992 | 466499266.587486
 EGYPT                     |   1998 | 277259220.420731
 EGYPT                     |   1997 | 465520016.655085
 EGYPT                     |   1996 |  468551740.78022
 EGYPT                     |   1995 | 465109794.092645
 EGYPT                     |   1994 | 462993546.436606
 EGYPT                     |   1993 | 473166920.058225
 EGYPT                     |   1992 |  464223158.11319
 ETHIOPIA                  |   1998 | 271021254.007971
 ETHIOPIA                  |   1997 | 462530392.769233
 ETHIOPIA                  |   1996 |  453408992.68142
 ETHIOPIA                  |   1995 | 459011430.780276
 ETHIOPIA                  |   1994 | 467290006.048526
 ETHIOPIA                  |   1993 | 451184724.829372
 ETHIOPIA                  |   1992 | 470512030.498616
 FRANCE                    |   1998 | 271147228.734927
 FRANCE                    |   1997 | 464248395.899968
 FRANCE                    |   1996 | 467699370.608694
 FRANCE                    |   1995 | 465279157.824861
 FRANCE                    |   1994 | 465107620.770279
 FRANCE                    |   1993 | 469756391.852278
 FRANCE                    |   1992 | 472104291.244123
 GERMANY                   |   1998 | 273228068.925485
 GERMANY                   |   1997 | 465985178.663719
 GERMANY                   |   1996 | 471433691.833241
 GERMANY                   |   1995 | 469521715.401994
 GERMANY                   |   1994 |  467361894.02104
 GERMANY                   |   1993 | 468889470.610061
 GERMANY                   |   1992 | 468553401.732564
 INDIA                     |   1998 | 277150993.447808
 INDIA                     |   1997 | 469633316.913759
 INDIA                     |   1996 | 473611240.982995
 INDIA                     |   1995 | 463313557.769853
 INDIA                     |   1994 | 469832530.092177
 INDIA                     |   1993 | 467572219.031439
 INDIA                     |   1992 |  466683173.78139
 INDONESIA                 |   1998 | 278623062.471741
 INDONESIA                 |   1997 | 467594314.258301
 INDONESIA                 |   1996 | 467566164.371288
 INDONESIA                 |   1995 | 467904215.894905
 INDONESIA                 |   1994 | 464876426.839157
 INDONESIA                 |   1993 | 474204056.395737
 INDONESIA                 |   1992 | 460637150.502584
 IRAN                      |   1998 | 267301290.636679
 IRAN                      |   1997 | 465421386.781508
 IRAN                      |   1996 | 457100961.521872
 IRAN                      |   1995 | 458540411.156571
 IRAN                      |   1994 | 458080977.565147
 IRAN                      |   1993 |  457733391.56651
 IRAN                      |   1992 | 463119135.431128
 IRAQ                      |   1998 | 274919740.903132
 IRAQ                      |   1997 | 472399378.452116
 IRAQ                      |   1996 | 477749056.742972
 IRAQ                      |   1995 | 470433740.770362
 IRAQ                      |   1994 | 468015340.884192
 IRAQ                      |   1993 | 483882966.195934
 IRAQ                      |   1992 | 477950522.927237
 JAPAN                     |   1998 | 269417218.592104
 JAPAN                     |   1997 | 467729610.750661
 JAPAN                     |   1996 | 469256540.797645
 JAPAN                     |   1995 | 468318200.450666
 JAPAN                     |   1994 | 467645090.869217
 JAPAN                     |   1993 | 476554054.012327
 JAPAN                     |   1992 | 472936488.964172
 JORDAN                    |   1998 | 269403406.720184
 JORDAN                    |   1997 | 455029185.394529
 JORDAN                    |   1996 | 456583749.344889
 JORDAN                    |   1995 | 460095951.060757
 JORDAN                    |   1994 | 458272310.613438
 JORDAN                    |   1993 |  457070469.84831
 JORDAN                    |   1992 | 455756971.400156
 KENYA                     |   1998 | 279710374.392396
 KENYA                     |   1997 | 480902252.591028
 KENYA                     |   1996 | 481439076.726056
 KENYA                     |   1995 | 471804261.739462
 KENYA                     |   1994 | 468798693.699045
 KENYA                     |   1993 |  474174185.23893
 KENYA                     |   1992 | 469717561.663089
 MOROCCO                   |   1998 | 274567358.976391
 MOROCCO                   |   1997 | 475362925.087025
 MOROCCO                   |   1996 | 469219712.541051
 MOROCCO                   |   1995 | 472456955.163848
 MOROCCO                   |   1994 | 472413573.834692
 MOROCCO                   |   1993 | 474415631.907883
 MOROCCO                   |   1992 | 475842567.707786
 MOZAMBIQUE                |   1998 | 277872373.987955
 MOZAMBIQUE                |   1997 | 461232199.955224
 MOZAMBIQUE                |   1996 | 464395089.679261
 MOZAMBIQUE                |   1995 | 466601738.759497
 MOZAMBIQUE                |   1994 | 466271046.516882
 MOZAMBIQUE                |   1993 | 465315701.494119
 MOZAMBIQUE                |   1992 | 458704965.672084
 PERU                      |   1998 | 274410566.351421
 PERU                      |   1997 |  467534484.94324
 PERU                      |   1996 | 467924328.630146
 PERU                      |   1995 | 463453600.623926
 PERU                      |   1994 | 465592337.343366
 PERU                      |   1993 | 465247972.924559
 PERU                      |   1992 | 471605040.464455
 ROMANIA                   |   1998 | 276158150.052329
 ROMANIA                   |   1997 | 477840081.140495
 ROMANIA                   |   1996 | 470466835.724721
 ROMANIA                   |   1995 | 470719978.127116
 ROMANIA                   |   1994 | 470099338.201212
 ROMANIA                   |   1993 | 471371721.582879
 ROMANIA                   |   1992 | 474617087.927115
 RUSSIA                    |   1998 | 268839785.159335
 RUSSIA                    |   1997 | 467183754.464843
 RUSSIA                    |   1996 | 476684045.471371
 RUSSIA                    |   1995 | 471085127.239396
 RUSSIA                    |   1994 | 466610649.619421
 RUSSIA                    |   1993 | 471761381.862157
 RUSSIA                    |   1992 | 465042278.549521
 SAUDI ARABIA              |   1998 | 273223193.991723
 SAUDI ARABIA              |   1997 |  473185417.75184
 SAUDI ARABIA              |   1996 | 472954664.038256
 SAUDI ARABIA              |   1995 | 469415842.572181
 SAUDI ARABIA              |   1994 | 467895757.211224
 SAUDI ARABIA              |   1993 | 468408894.081155
 SAUDI ARABIA              |   1992 |  469111803.86124
 UNITED KINGDOM            |   1998 | 263253928.174612
 UNITED KINGDOM            |   1997 | 467710295.607059
 UNITED KINGDOM            |   1996 | 472367155.711374
 UNITED KINGDOM            |   1995 | 462802324.779513
 UNITED KINGDOM            |   1994 | 462156178.448815
 UNITED KINGDOM            |   1993 | 463445312.816533
 UNITED KINGDOM            |   1992 | 468333300.461711
 UNITED STATES             |   1998 | 281325798.857375
 UNITED STATES             |   1997 | 479236145.222832
 UNITED STATES             |   1996 | 470003497.674019
 UNITED STATES             |   1995 | 470250103.064053
 UNITED STATES             |   1994 | 468110288.963735
 UNITED STATES             |   1993 | 471980724.609753
 UNITED STATES             |   1992 | 471972692.929094
 VIETNAM                   |   1998 | 276589983.787021
 VIETNAM                   |   1997 | 467758978.345533
 VIETNAM                   |   1996 | 474359250.571522
 VIETNAM                   |   1995 | 468175491.546072
 VIETNAM                   |   1994 | 468316366.264704
 VIETNAM                   |   1993 | 466333172.968057
 VIETNAM                   |   1992 | 462056921.531618
(175 rows)

COMMIT;
COMMIT
