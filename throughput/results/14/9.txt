BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%misty%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 271998205.455147
 ALGERIA                   |   1997 | 455204191.522385
 ALGERIA                   |   1996 | 463529653.514361
 ALGERIA                   |   1995 |  468405906.41858
 ALGERIA                   |   1994 | 459654392.818345
 ALGERIA                   |   1993 | 455869165.983009
 ALGERIA                   |   1992 | 457728671.135552
 ARGENTINA                 |   1998 | 279813470.651399
 ARGENTINA                 |   1997 | 462169279.447309
 ARGENTINA                 |   1996 | 468360258.736721
 ARGENTINA                 |   1995 | 468039612.032203
 ARGENTINA                 |   1994 | 466298317.633541
 ARGENTINA                 |   1993 | 464398690.837423
 ARGENTINA                 |   1992 | 469733105.717936
 BRAZIL                    |   1998 | 267714713.153579
 BRAZIL                    |   1997 | 465451074.453499
 BRAZIL                    |   1996 | 457088184.261033
 BRAZIL                    |   1995 | 463729908.752519
 BRAZIL                    |   1994 | 449959409.008956
 BRAZIL                    |   1993 | 457588183.079558
 BRAZIL                    |   1992 | 464291266.161859
 CANADA                    |   1998 | 275784856.919025
 CANADA                    |   1997 | 472978436.932009
 CANADA                    |   1996 |  466700724.90399
 CANADA                    |   1995 | 472045459.627789
 CANADA                    |   1994 | 479026115.515549
 CANADA                    |   1993 | 475850502.378267
 CANADA                    |   1992 | 477953490.214471
 CHINA                     |   1998 | 272331949.103704
 CHINA                     |   1997 | 458436890.611569
 CHINA                     |   1996 | 472288041.121509
 CHINA                     |   1995 | 469678499.874017
 CHINA                     |   1994 | 466652310.033395
 CHINA                     |   1993 | 470008541.324671
 CHINA                     |   1992 | 460394387.695611
 EGYPT                     |   1998 | 267490910.268671
 EGYPT                     |   1997 | 461947713.284373
 EGYPT                     |   1996 | 465839296.428341
 EGYPT                     |   1995 | 456482735.577227
 EGYPT                     |   1994 | 448154430.107426
 EGYPT                     |   1993 | 461891443.989974
 EGYPT                     |   1992 | 459732427.371935
 ETHIOPIA                  |   1998 |  273190675.36569
 ETHIOPIA                  |   1997 |   455717789.7437
 ETHIOPIA                  |   1996 | 456285643.306946
 ETHIOPIA                  |   1995 |  450261533.34646
 ETHIOPIA                  |   1994 | 452099190.108302
 ETHIOPIA                  |   1993 | 461610505.697627
 ETHIOPIA                  |   1992 | 458587281.633618
 FRANCE                    |   1998 | 269915927.756532
 FRANCE                    |   1997 | 464875812.528109
 FRANCE                    |   1996 | 466700982.848475
 FRANCE                    |   1995 |  462207491.28502
 FRANCE                    |   1994 | 470052676.013503
 FRANCE                    |   1993 |  464105607.36852
 FRANCE                    |   1992 | 460079850.821412
 GERMANY                   |   1998 | 278003905.269727
 GERMANY                   |   1997 | 473780713.074995
 GERMANY                   |   1996 | 468087945.128678
 GERMANY                   |   1995 | 480411238.495655
 GERMANY                   |   1994 | 472647202.366736
 GERMANY                   |   1993 | 472155037.499173
 GERMANY                   |   1992 | 467327575.219058
 INDIA                     |   1998 | 272372073.936182
 INDIA                     |   1997 | 472523036.497565
 INDIA                     |   1996 |  476403765.08195
 INDIA                     |   1995 |  473995324.63333
 INDIA                     |   1994 |  476280555.13067
 INDIA                     |   1993 | 471010593.399825
 INDIA                     |   1992 |  471458237.95838
 INDONESIA                 |   1998 | 274685798.721628
 INDONESIA                 |   1997 | 461268610.181125
 INDONESIA                 |   1996 | 465534048.697575
 INDONESIA                 |   1995 | 463826967.951821
 INDONESIA                 |   1994 | 459014060.079865
 INDONESIA                 |   1993 |  457556086.03802
 INDONESIA                 |   1992 |  455022420.66387
 IRAN                      |   1998 | 271257919.705438
 IRAN                      |   1997 | 460099657.590796
 IRAN                      |   1996 | 459402804.886566
 IRAN                      |   1995 | 464104510.825549
 IRAN                      |   1994 | 452791193.216981
 IRAN                      |   1993 | 461646475.489048
 IRAN                      |   1992 |  466424723.93715
 IRAQ                      |   1998 | 279854515.311406
 IRAQ                      |   1997 | 464983795.222986
 IRAQ                      |   1996 | 476182433.745443
 IRAQ                      |   1995 | 473207598.387555
 IRAQ                      |   1994 | 476878753.270948
 IRAQ                      |   1993 | 467137590.602861
 IRAQ                      |   1992 |  474782536.71526
 JAPAN                     |   1998 | 262312785.724142
 JAPAN                     |   1997 | 464256437.346611
 JAPAN                     |   1996 | 460722117.114721
 JAPAN                     |   1995 | 458231628.021762
 JAPAN                     |   1994 | 454241275.044703
 JAPAN                     |   1993 | 461039828.222406
 JAPAN                     |   1992 |  459761963.58943
 JORDAN                    |   1998 | 271114929.273466
 JORDAN                    |   1997 | 462278113.516904
 JORDAN                    |   1996 | 460267207.575931
 JORDAN                    |   1995 | 461128836.558869
 JORDAN                    |   1994 | 458747549.779475
 JORDAN                    |   1993 | 472389057.826115
 JORDAN                    |   1992 | 459702156.245686
 KENYA                     |   1998 | 280537548.225128
 KENYA                     |   1997 | 462792481.406575
 KENYA                     |   1996 | 473731144.708264
 KENYA                     |   1995 | 472904081.528096
 KENYA                     |   1994 | 478189133.573926
 KENYA                     |   1993 | 472374133.490336
 KENYA                     |   1992 | 476020977.802979
 MOROCCO                   |   1998 | 272688689.043447
 MOROCCO                   |   1997 | 470081108.321568
 MOROCCO                   |   1996 | 477951686.293822
 MOROCCO                   |   1995 | 470469797.675772
 MOROCCO                   |   1994 | 470328905.500455
 MOROCCO                   |   1993 |  466524906.22382
 MOROCCO                   |   1992 | 469482948.009166
 MOZAMBIQUE                |   1998 | 274596669.368516
 MOZAMBIQUE                |   1997 | 464753984.455111
 MOZAMBIQUE                |   1996 | 473623702.654502
 MOZAMBIQUE                |   1995 | 467454324.707792
 MOZAMBIQUE                |   1994 | 465555318.776198
 MOZAMBIQUE                |   1993 | 465721582.260547
 MOZAMBIQUE                |   1992 | 457504150.536818
 PERU                      |   1998 | 265526630.951368
 PERU                      |   1997 | 456960163.235214
 PERU                      |   1996 | 467377166.524362
 PERU                      |   1995 |  464006487.02587
 PERU                      |   1994 | 458952299.362677
 PERU                      |   1993 | 453485349.549887
 PERU                      |   1992 | 463789197.606614
 ROMANIA                   |   1998 | 278759752.089984
 ROMANIA                   |   1997 | 478048275.387873
 ROMANIA                   |   1996 | 476268414.476189
 ROMANIA                   |   1995 | 467674047.455486
 ROMANIA                   |   1994 | 473261865.592125
 ROMANIA                   |   1993 | 469628086.758527
 ROMANIA                   |   1992 | 470246585.745873
 RUSSIA                    |   1998 | 272563104.846638
 RUSSIA                    |   1997 | 464728501.299314
 RUSSIA                    |   1996 | 464937116.918991
 RUSSIA                    |   1995 |  468959704.49461
 RUSSIA                    |   1994 | 462516914.840645
 RUSSIA                    |   1993 | 464947695.248467
 RUSSIA                    |   1992 | 464618695.695114
 SAUDI ARABIA              |   1998 |  277538500.00016
 SAUDI ARABIA              |   1997 | 467941943.902906
 SAUDI ARABIA              |   1996 | 465330200.762035
 SAUDI ARABIA              |   1995 | 475270909.104901
 SAUDI ARABIA              |   1994 | 468104993.482483
 SAUDI ARABIA              |   1993 | 470194161.556224
 SAUDI ARABIA              |   1992 | 474241295.593181
 UNITED KINGDOM            |   1998 | 268955728.433793
 UNITED KINGDOM            |   1997 | 456317395.577181
 UNITED KINGDOM            |   1996 | 448916054.153995
 UNITED KINGDOM            |   1995 | 458056920.849874
 UNITED KINGDOM            |   1994 | 458751289.748306
 UNITED KINGDOM            |   1993 | 458130798.445441
 UNITED KINGDOM            |   1992 | 445575745.214086
 UNITED STATES             |   1998 | 274190440.758557
 UNITED STATES             |   1997 | 483512781.385583
 UNITED STATES             |   1996 | 480536611.298135
 UNITED STATES             |   1995 |  472610568.59516
 UNITED STATES             |   1994 | 476428990.740371
 UNITED STATES             |   1993 | 475510199.988645
 UNITED STATES             |   1992 | 477395286.221573
 VIETNAM                   |   1998 | 273609711.578155
 VIETNAM                   |   1997 | 466457208.846051
 VIETNAM                   |   1996 | 476460554.163658
 VIETNAM                   |   1995 | 457494949.084714
 VIETNAM                   |   1994 | 465180452.396501
 VIETNAM                   |   1993 | 464563737.201248
 VIETNAM                   |   1992 | 473189133.955158
(175 rows)

COMMIT;
COMMIT
