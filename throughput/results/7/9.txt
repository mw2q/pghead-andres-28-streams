BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%azure%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 272144445.986241
 ALGERIA                   |   1997 | 457169734.063055
 ALGERIA                   |   1996 | 459116957.887494
 ALGERIA                   |   1995 | 462834993.188215
 ALGERIA                   |   1994 | 464684315.632651
 ALGERIA                   |   1993 | 458391200.168945
 ALGERIA                   |   1992 | 466331197.829872
 ARGENTINA                 |   1998 | 283880781.519586
 ARGENTINA                 |   1997 | 477604815.050069
 ARGENTINA                 |   1996 |  481574196.74166
 ARGENTINA                 |   1995 | 472318190.049982
 ARGENTINA                 |   1994 | 473315670.852034
 ARGENTINA                 |   1993 | 467321005.803203
 ARGENTINA                 |   1992 | 476957824.986727
 BRAZIL                    |   1998 | 271934277.854347
 BRAZIL                    |   1997 | 474570055.370429
 BRAZIL                    |   1996 | 475934363.261824
 BRAZIL                    |   1995 | 465494014.292886
 BRAZIL                    |   1994 | 465237940.655505
 BRAZIL                    |   1993 | 474410673.948963
 BRAZIL                    |   1992 | 473501209.483423
 CANADA                    |   1998 |  280998533.66528
 CANADA                    |   1997 |  474704411.26888
 CANADA                    |   1996 | 476627185.134589
 CANADA                    |   1995 |  480923331.97713
 CANADA                    |   1994 | 484859323.632283
 CANADA                    |   1993 | 474811467.077237
 CANADA                    |   1992 | 481565178.405272
 CHINA                     |   1998 | 277077518.526352
 CHINA                     |   1997 | 468873104.375195
 CHINA                     |   1996 | 473730589.879909
 CHINA                     |   1995 | 469521298.655322
 CHINA                     |   1994 | 460139463.802271
 CHINA                     |   1993 | 471146182.766607
 CHINA                     |   1992 | 474850218.301396
 EGYPT                     |   1998 | 264212292.531034
 EGYPT                     |   1997 | 460226826.443895
 EGYPT                     |   1996 | 460197318.785735
 EGYPT                     |   1995 | 458677135.656268
 EGYPT                     |   1994 | 464878448.908999
 EGYPT                     |   1993 | 460143131.867999
 EGYPT                     |   1992 | 455179385.178098
 ETHIOPIA                  |   1998 | 282190182.255207
 ETHIOPIA                  |   1997 | 459467277.805502
 ETHIOPIA                  |   1996 | 461869504.360909
 ETHIOPIA                  |   1995 |  467542726.33622
 ETHIOPIA                  |   1994 | 466319760.438284
 ETHIOPIA                  |   1993 | 470235611.243995
 ETHIOPIA                  |   1992 | 458616067.321299
 FRANCE                    |   1998 | 271367893.359557
 FRANCE                    |   1997 | 467404816.692834
 FRANCE                    |   1996 |  466425903.54878
 FRANCE                    |   1995 | 461296234.956697
 FRANCE                    |   1994 | 462879643.313231
 FRANCE                    |   1993 | 462164582.604399
 FRANCE                    |   1992 | 465735777.942331
 GERMANY                   |   1998 | 279051220.374917
 GERMANY                   |   1997 | 477293437.788074
 GERMANY                   |   1996 | 474227765.374069
 GERMANY                   |   1995 | 481576288.204129
 GERMANY                   |   1994 | 481301919.963353
 GERMANY                   |   1993 | 479701702.659124
 GERMANY                   |   1992 | 470239500.514529
 INDIA                     |   1998 | 272815006.409161
 INDIA                     |   1997 | 467110784.670947
 INDIA                     |   1996 | 480149119.499675
 INDIA                     |   1995 | 472660337.329177
 INDIA                     |   1994 | 473635901.680211
 INDIA                     |   1993 |  468498678.58693
 INDIA                     |   1992 | 471983730.958286
 INDONESIA                 |   1998 | 269590116.002888
 INDONESIA                 |   1997 | 458277729.391673
 INDONESIA                 |   1996 | 469916192.380549
 INDONESIA                 |   1995 | 458630846.506539
 INDONESIA                 |   1994 | 450616657.567388
 INDONESIA                 |   1993 | 463718128.182306
 INDONESIA                 |   1992 | 457239255.109398
 IRAN                      |   1998 | 273630047.653037
 IRAN                      |   1997 | 462660019.324083
 IRAN                      |   1996 | 462911553.909286
 IRAN                      |   1995 | 472827478.245737
 IRAN                      |   1994 | 466683050.807293
 IRAN                      |   1993 | 462478808.350357
 IRAN                      |   1992 | 457367049.009756
 IRAQ                      |   1998 | 273858735.516863
 IRAQ                      |   1997 | 458739966.664399
 IRAQ                      |   1996 | 468414726.708336
 IRAQ                      |   1995 | 464398133.254866
 IRAQ                      |   1994 | 464824937.952631
 IRAQ                      |   1993 | 465895533.893196
 IRAQ                      |   1992 | 473557799.481615
 JAPAN                     |   1998 | 274601863.902492
 JAPAN                     |   1997 | 471476344.302463
 JAPAN                     |   1996 | 468428061.482626
 JAPAN                     |   1995 | 464262440.184581
 JAPAN                     |   1994 | 471779548.158149
 JAPAN                     |   1993 | 471445523.510075
 JAPAN                     |   1992 | 461946608.479807
 JORDAN                    |   1998 | 268860681.901516
 JORDAN                    |   1997 | 465521014.366716
 JORDAN                    |   1996 | 464495586.645276
 JORDAN                    |   1995 | 461451599.713528
 JORDAN                    |   1994 | 465758174.565113
 JORDAN                    |   1993 | 462012511.754517
 JORDAN                    |   1992 | 462123763.040054
 KENYA                     |   1998 |  277377159.12479
 KENYA                     |   1997 | 472246444.273593
 KENYA                     |   1996 | 471432971.635045
 KENYA                     |   1995 | 472133745.015831
 KENYA                     |   1994 | 469790119.568649
 KENYA                     |   1993 |  470520970.96928
 KENYA                     |   1992 | 474265959.192234
 MOROCCO                   |   1998 | 276166228.208114
 MOROCCO                   |   1997 | 473652187.072928
 MOROCCO                   |   1996 | 471905796.906574
 MOROCCO                   |   1995 | 477798641.618111
 MOROCCO                   |   1994 | 465755445.830535
 MOROCCO                   |   1993 | 472163607.617773
 MOROCCO                   |   1992 | 477096232.409787
 MOZAMBIQUE                |   1998 | 276517340.854193
 MOZAMBIQUE                |   1997 | 463584777.058499
 MOZAMBIQUE                |   1996 | 464277843.676315
 MOZAMBIQUE                |   1995 | 463850249.418085
 MOZAMBIQUE                |   1994 | 463174860.162796
 MOZAMBIQUE                |   1993 | 470624677.948416
 MOZAMBIQUE                |   1992 | 464358692.222865
 PERU                      |   1998 | 275050123.140491
 PERU                      |   1997 | 465928230.847679
 PERU                      |   1996 | 469640279.834493
 PERU                      |   1995 | 456564303.818366
 PERU                      |   1994 | 466563361.268963
 PERU                      |   1993 | 460246951.628872
 PERU                      |   1992 | 462746612.555865
 ROMANIA                   |   1998 | 272818019.824702
 ROMANIA                   |   1997 | 467726122.625509
 ROMANIA                   |   1996 | 471066152.004435
 ROMANIA                   |   1995 | 468662464.380876
 ROMANIA                   |   1994 | 455328673.144838
 ROMANIA                   |   1993 | 457437885.742613
 ROMANIA                   |   1992 | 473266272.265316
 RUSSIA                    |   1998 |  272317003.94363
 RUSSIA                    |   1997 | 468151743.044397
 RUSSIA                    |   1996 | 459778569.105693
 RUSSIA                    |   1995 | 467739432.071581
 RUSSIA                    |   1994 | 467991479.932399
 RUSSIA                    |   1993 | 466654008.957777
 RUSSIA                    |   1992 | 468905559.969848
 SAUDI ARABIA              |   1998 | 275456475.820799
 SAUDI ARABIA              |   1997 | 475609100.746072
 SAUDI ARABIA              |   1996 | 471447864.394576
 SAUDI ARABIA              |   1995 | 467927298.865503
 SAUDI ARABIA              |   1994 | 466788079.744794
 SAUDI ARABIA              |   1993 | 476124342.939116
 SAUDI ARABIA              |   1992 | 477273330.588507
 UNITED KINGDOM            |   1998 | 274447980.881085
 UNITED KINGDOM            |   1997 | 465203039.497073
 UNITED KINGDOM            |   1996 | 460799287.400156
 UNITED KINGDOM            |   1995 | 461380327.177828
 UNITED KINGDOM            |   1994 | 460787915.426314
 UNITED KINGDOM            |   1993 |   466558155.5934
 UNITED KINGDOM            |   1992 |   461834512.5977
 UNITED STATES             |   1998 | 271555117.535476
 UNITED STATES             |   1997 | 475691789.314741
 UNITED STATES             |   1996 | 481273669.159546
 UNITED STATES             |   1995 | 478848902.249634
 UNITED STATES             |   1994 | 476600981.005517
 UNITED STATES             |   1993 | 467844027.105678
 UNITED STATES             |   1992 | 473555999.599973
 VIETNAM                   |   1998 | 271656932.113314
 VIETNAM                   |   1997 | 458598376.666552
 VIETNAM                   |   1996 | 473526637.027463
 VIETNAM                   |   1995 | 459471299.926607
 VIETNAM                   |   1994 | 467039124.336383
 VIETNAM                   |   1993 | 462841005.309974
 VIETNAM                   |   1992 | 463423504.170678
(175 rows)

COMMIT;
COMMIT
